(this["webpackJsonpwebrtc-chat"]=this["webpackJsonpwebrtc-chat"]||[]).push([[0],{46:function(e,t,n){},79:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},83:function(e,t,n){},84:function(e,t,n){},85:function(e,t,n){},86:function(e,t,n){},87:function(e,t,n){},88:function(e,t,n){},89:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),o=n(40),i=n.n(o),s=(n(46),n(2)),a=n(5),u=n.n(a),d=n(16),l=n(3),f=n(4),v=n(12),h=n(11),j=n(41),m=new(function(){function e(){Object(l.a)(this,e),this._user={id:"",name:"",room:this.roomId}}return Object(f.a)(e,[{key:"user",get:function(){return this._user},set:function(e){this._user=e,console.log("Logged",this._user)}},{key:"roomId",get:function(){if(void 0===this._user||void 0===this._user.room){var e=new URL(window.location.href),t=new URLSearchParams(e.search),n=t.get("room");return n||(n=function(){var e=function(){return Math.floor(65536*Math.random()).toString(16)};return"".concat(e()).concat(e(),"-").concat(e()).concat(e(),"}")}(),t.append("room",n),window.location.search=t),n}return this._user.room}}]),e}()),b=function(){function e(){Object(l.a)(this,e),this._eventListeners={}}return Object(f.a)(e,[{key:"addEventListener",value:function(e,t){void 0===this._eventListeners[e]&&(this._eventListeners[e]=[]),this._eventListeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){void 0!==this._eventListeners[e]&&(this._eventListeners[e]=this._eventListeners[e].filter((function(e){return e.toString()!==t.toString()})),0===this._eventListeners[e].length&&delete this._eventListeners[e])}}]),e}(),O=new(function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.call(this))._log=[],e}return Object(f.a)(n,[{key:"log",get:function(){return this._log}},{key:"push",value:function(e){var t,n,c=this;e.data.time=new Date(e.data.time),this._log.push(e),null===(t=this._eventListeners.newMessage)||void 0===t||t.forEach((function(t){return t(e)})),null===(n=this._eventListeners.newMessages)||void 0===n||n.forEach((function(e){return e(c._log)}))}}]),n}(b)),g=new(function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.call(this)).onConnect=function(t){var n;null===(n=e._eventListeners.connectionChange)||void 0===n||n.forEach((function(t){t(e.socket.connected)}))},e.onError=function(t){var n;null===(n=e._eventListeners.error)||void 0===n||n.forEach((function(e){e(t)}))},e.onLogged=function(t){var n;null===(n=e._eventListeners.logged)||void 0===n||n.forEach((function(e){e(t)}))},e.onRoomData=function(t){var n;null===(n=e._eventListeners.usersChange)||void 0===n||n.forEach((function(e){e(t.users)}))},e.onBeforeUnload=function(){e.socket.emit("disconnect")},e.onMessage=function(e){O.push(e)},e.sendNewMessage=function(e){g.socket.emit("sendMessage",{text:e})},e.sendRTCOverSocket=function(e,t,n){g.socket.emit("webrtc",{id:m.user.id,to:e,type:t,data:n})},e.socket=Object(j.io)("https://webrtc-chat-api.herokuapp.com/",{reconnectionDelayMax:1e4}),e.socket.on("connect",e.onConnect),e.socket.on("disconnect",e.onConnect),e}return Object(f.a)(n,[{key:"connect",value:function(e){var t=e.user,n=e.room;this.socket.connected&&(this.socket.on("webrtc",x.socketReceived),this.socket.on("webrtc_new_peer",x.webrtcNewPeer),this.socket.on("roomData",this.onRoomData),this.socket.on("message",this.onMessage),this.socket.on("logged",this.onLogged),this.socket.on("error",this.onError),this.socket.emit("join",{username:t,room:n}))}}]),n}(b)),p=new(function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.call(this))._id=null,e._localStream=void 0,e.getUserMedia().then((function(t){e._localStream=t})).catch((function(e){return console.error("Error get user media",e)})),e._streams={},e}return Object(f.a)(n,[{key:"localId",get:function(){return this._id},set:function(e){this._id=e,this.addStream(e,this._localStream)}},{key:"localStream",get:function(){return this._localStream}},{key:"getUserMedia",value:function(){return navigator.mediaDevices.getUserMedia({video:!0,audio:!0})}},{key:"addStream",value:function(e,t){var n,c=this;this._streams[e]=t,null===(n=this._eventListeners["streamAdded-".concat(e)])||void 0===n||n.forEach((function(t){void 0!==c._streams[e]&&t(c._streams[e])})),this._id===e&&(this._localStream=this._streams[e])}},{key:"getTrack",value:function(e,t){var n;if(void 0!==this._streams[e]){switch(t){case"audio":n=this._streams[e].getAudioTracks()[0];break;case"video":n=this._streams[e].getVideoTracks()[0];break;default:return void console.warn("Unknown stream type",t)}return n}console.warn("Stream doesn't exist",e)}},{key:"getState",value:function(e,t){var n;return null!==(n=this.getTrack(e,t))&&void 0!==n?n:{enabled:!1}}},{key:"toggleStream",value:function(e,t){var n,c=this,r=this.getTrack(e,t);void 0!==r&&(r.enabled=!r.enabled,null===(n=this._eventListeners["streamToggled-".concat(e)])||void 0===n||n.forEach((function(t){void 0!==c._streams[e]&&t(c._streams[e])})));return null!==r&&void 0!==r?r:{enabled:!1}}},{key:"removeStream",value:function(e){void 0!==this._streams[e]&&delete this._streams[e]}},{key:"getStream",value:function(e){return this._streams[e]}}]),n}(b)),x=new(function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.call(this)).onBeforeUnload=function(){for(var t in e.peers)if(e.peers.hasOwnProperty(t)&&void 0!==e.peers[t].channel)try{e.peers[t].channel.close()}catch(n){console.error(n)}},e.webrtcNewPeer=function(){var t=Object(d.a)(u.a.mark((function t(n){var c,r,o,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=n.user,r=n.data,"SERVER"===c){t.next=3;break}return t.abrupt("return");case 3:return o=r.id,r.name,r.room,e.createConnection(o),i=e.peers[o].connection,e.initConnection(o,i),t.next=9,e.initMedia(o,i);case 9:return t.next=11,i.createOffer().then((function(e){return i.setLocalDescription(e).then((function(){g.sendRTCOverSocket(o,"offer",e)})).catch((function(e){return console.error("Error set local description",e)}))})).catch((function(e){return console.error("Error create offer",e)}));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.socketReceived=function(t){var n=t.id,c=t.to,r=t.type,o=t.data;switch(r){case"candidate":e.remoteCandidateReceived(n,o);break;case"offer":e.remoteOfferReceived(n,o);break;case"answer":e.remoteAnswerReceived(n,o);break;default:console.log("Unknown type received from socket:"),console.log({id:n,to:c,type:r,data:o})}},e.remoteAnswerReceived=function(){var t=Object(d.a)(u.a.mark((function t(n,c){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.peers[n].connection,t.next=3,r.setRemoteDescription(c).catch((function(e){return console.error("Error set remote description",e)}));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.remoteCandidateReceived=function(){var t=Object(d.a)(u.a.mark((function t(n,c){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.createConnection(n),r=e.peers[n].connection,t.next=4,r.addIceCandidate(c).catch((function(e){return console.error("Error add iceCandidate",e)}));case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.remoteOfferReceived=function(){var t=Object(d.a)(u.a.mark((function t(n,c){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.createConnection(n),r=e.peers[n].connection,t.next=4,e.initMedia(n,r);case 4:return e.initConnection(n,r),t.next=7,r.setRemoteDescription(c).then((function(){r.createAnswer().then((function(e){return r.setLocalDescription(e).then((function(){g.sendRTCOverSocket(n,"answer",e)})).catch((function(e){return console.error("Error set local description",e)}))})).catch((function(e){return console.error("Error create answer",e)}))})).catch((function(e){return console.error("Error set remote description",e)}));case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.initConnection=function(t,n){n.onicecandidate=function(e){e.candidate&&g.sendRTCOverSocket(t,"candidate",e.candidate)},n.oniceconnectionstatechange=function(c){switch(n.iceConnectionState){case"disconnected":delete e.peers[t],p.removeStream(t),e.connectionsCount=e.connectionsCount-1,console.log("[".concat(t,"] disconnected. Peers: ").concat(e.connectionsCount));break;case"connected":e.connectionsCount=e.connectionsCount+1,console.log("[".concat(t,"] connected. Peers: ").concat(e.connectionsCount));break;default:console.log(n.iceConnectionState)}}},e.initMedia=function(){var e=Object(d.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.ontrack=function(e){var n=Object(s.a)(e.streams,1)[0];p.addStream(t,n)},void 0!==p.localStream&&p.localStream.getTracks().forEach((function(e){n.addTrack(e,p.localStream)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.createConnection=function(t){void 0===e.peers[t]&&(e.peers[t]={},e.peers[t].connection=new RTCPeerConnection(e.server))},e._connectionsCount=0,e.peers={},e.server={iceServers:[{url:"turn:webrtc-chat-api.herokuapp.com:3478",username:"turnclient",credential:"$0mep@$$w0rd"},{url:"stun:webrtc-chat-api.herokuapp.com"},{url:"turn:217.150.77.131:3478",username:"turnclient",credential:"$0mep@$$w0rd"},{url:"stun:217.150.77.131:3478"},{url:"stun:stun.l.google.com:19302"},{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"}]},e}return Object(f.a)(n,[{key:"connectionsCount",get:function(){return this._connectionsCount},set:function(e){var t,n=this;this._connectionsCount=e,null===(t=this._eventListeners.connectionsChange)||void 0===t||t.forEach((function(e){e({count:n._connectionsCount,peers:n.peers})}))}}]),n}(b)),k=(n(79),n(0));function w(){var e=Object(c.useState)(""),t=Object(s.a)(e,2),n=t[0],r=t[1],o=Object(c.useState)(""),i=Object(s.a)(o,2),a=i[0],u=i[1],d=Object(c.useState)(""),l=Object(s.a)(d,2),f=l[0],v=l[1];Object(c.useEffect)((function(){return g.addEventListener("error",h),g.addEventListener("connectionChange",j),function(){g.removeEventListener("error",h),g.removeEventListener("connectionChange",j)}}),[]);var h=function(e){switch(e.type){case"addUser":u(e.error)}},j=function(e){v(e)},b=function(e){g.connect({user:n,room:m.user.room})};return Object(k.jsx)("div",{className:"Login",children:Object(k.jsxs)("div",{className:"login-container",children:[Object(k.jsxs)("div",{className:"login-info-container",children:[Object(k.jsx)("label",{htmlFor:"uname",children:Object(k.jsx)("b",{children:"Username"})}),Object(k.jsx)("label",{className:"info-connected",style:{color:f?"#B1D9CD":"#FDB196"},children:Object(k.jsx)("b",{children:f?"Connected":"Disconnected"})})]}),Object(k.jsx)("input",{type:"text",placeholder:"Enter Username",onChange:function(e){r(e.target.value)},onKeyDown:function(e){13===e.keyCode&&b()},required:!0}),Object(k.jsx)("div",{className:"login-error",children:a}),Object(k.jsx)("button",{type:"submit",onClick:b,children:"Login"})]})})}var C=n(15);n(81);function _(){var e=Object(c.useState)([]),t=Object(s.a)(e,2),n=t[0],r=t[1];Object(c.useEffect)((function(){return g.addEventListener("usersChange",o),function(){g.removeEventListener("usersChange",o)}}),[]);var o=function(e){r(Object(C.a)(e))};return Object(k.jsx)("div",{className:"UsersList",children:Object(k.jsx)("div",{className:"users-list-container",children:Object(k.jsx)("ol",{className:"users-list",children:n.map((function(e){return Object(k.jsxs)("li",{className:"list-item",children:[Object(k.jsx)("div",{className:"user-item-gradient"}),Object(k.jsx)("div",{className:"user-item-content",children:Object(k.jsx)("h4",{children:"".concat(e.name)})})]},e.id)}))})})})}n(82),n(83);function L(e){var t=e.videoId,n=e.title,r=e.type,o=e.onClick,i=Object(c.useRef)(null);Object(c.useEffect)((function(){p.addEventListener("streamAdded-".concat(t),s),p.addEventListener("streamToggled-".concat(t),a);var e=p.getStream(t);return null!==i&&void 0!==e&&(i.current.srcObject=e),function(){p.removeEventListener("streamAdded-".concat(t),s),p.removeEventListener("streamToggled-".concat(t),a)}}),[]);var s=function(e){null!==i&&(i.current.srcObject=e)},a=function(e){null!==i&&(i.current.srcObject=e)};return Object(k.jsxs)("article",{className:"video-listing",children:[Object(k.jsx)("div",{onClick:function(e){o(e)},id:"title-".concat(t),className:"video-title",children:n}),Object(k.jsx)("div",{className:"video-container",children:Object(k.jsx)("video",{ref:i,autoPlay:!0,muted:"local"===r,className:"".concat(r,"-video"),id:"video-".concat(t)})})]},"article-".concat(t))}var E=n.p+"static/media/camera.53281603.svg",y=n.p+"static/media/microphone.b5ad8492.svg";n(84);function S(){var e=Object(c.useState)(p.getState(p.localId,"video").enabled),t=Object(s.a)(e,2),n=t[0],r=t[1],o=Object(c.useState)(p.getState(p.localId,"audio").enabled),i=Object(s.a)(o,2),a=i[0],u=i[1];return Object(k.jsx)("div",{className:"StreamControls",children:Object(k.jsxs)("div",{className:"controls-container",children:[Object(k.jsx)("div",{style:{backgroundColor:n?"#B1D9CD":"#FDB196"},className:"round-container",onClick:function(){r(p.toggleStream(p.localId,"video").enabled)},children:Object(k.jsx)("img",{src:E,alt:"camera icon"})}),Object(k.jsx)("div",{style:{backgroundColor:a?"#B1D9CD":"#FDB196"},className:"round-container",onClick:function(){u(p.toggleStream(p.localId,"audio").enabled)},children:Object(k.jsx)("img",{src:y,alt:"microphone icon"})})]})})}function N(){var e=Object(c.useState)([]),t=Object(s.a)(e,2),n=t[0],r=t[1],o=Object(c.useRef)(null);Object(c.useEffect)((function(){return g.addEventListener("usersChange",i),function(){g.removeEventListener("usersChange",i)}}),[]);var i=function(e){r(Object(C.a)(e))},a=function(e){o.current.srcObject=document.getElementById("video-".concat(e.target.id.substr(6))).srcObject};return Object(k.jsxs)("div",{className:"VideoGrid",children:[Object(k.jsxs)("div",{className:"video-row-container",children:[Object(k.jsx)(L,{title:m.user.name,videoId:m.user.id,onClick:a,type:"local"}),n.filter((function(e){return e.id!==m.user.id})).map((function(e){return Object(k.jsx)(L,{title:e.name,videoId:e.id,onClick:a,type:"remote"},"video-".concat(e.id))}))]}),Object(k.jsx)("div",{className:"selected-video-container",children:Object(k.jsx)("video",{ref:o,autoPlay:!0,muted:!0,className:"selected-video",id:"selected-video"})}),Object(k.jsx)("div",{className:"stream-controls-container",children:Object(k.jsx)(S,{})})]})}n(85),n(86);function D(){var e=Object(c.useState)([]),t=Object(s.a)(e,2),n=t[0],r=t[1];Object(c.useEffect)((function(){return O.addEventListener("newMessage",o),function(){O.removeEventListener("newMessage",o)}}),[]);var o=function(e){r((function(t){return[].concat(Object(C.a)(t),[e])}))};return Object(k.jsx)("div",{className:"ChatHistory",children:Object(k.jsx)("div",{className:"chat-history-container",children:n.map((function(e,t){return Object(k.jsxs)("div",{children:[Object(k.jsxs)("div",{className:"info-container",children:[Object(k.jsx)("div",{className:"user",children:"".concat(e.user)}),Object(k.jsx)("div",{className:"time",children:(n=e.data.time,"".concat(("0"+n.getHours()).substr(-2),":").concat(("0"+n.getMinutes()).substr(-2)))})]}),Object(k.jsx)("span",{style:{whiteSpace:"pre-line"},className:"message",children:"".concat(e.data.text)})]},t);var n}))})})}n(87);function R(){var e=Object(c.useRef)(null),t=Object(c.useState)(""),n=Object(s.a)(t,2),r=n[0],o=n[1],i=Object(c.useState)("auto"),a=Object(s.a)(i,2),u=a[0],d=a[1];Object(c.useEffect)((function(){d("".concat(e.current.scrollHeight+2,"px"))}),[r]);var l=function(){var e=r.trim();0!==e.length&&(g.sendNewMessage(e),o(""),d("auto"))};return Object(k.jsx)("div",{className:"AutoTextArea",children:Object(k.jsxs)("div",{className:"text-area-container",children:[Object(k.jsx)("textarea",{className:"auto-text-area",ref:e,rows:1,style:{height:u,flexGrow:1},value:r,onChange:function(e){d("auto"),o(e.target.value)},onKeyDown:function(e){e.shiftKey||13!==e.keyCode||(l(),e.preventDefault())}}),Object(k.jsx)("button",{onClick:l,children:Object(k.jsx)("svg",{id:"send-icon",className:"send-icon",viewBox:"0 0 488.721 488.721",children:Object(k.jsx)("path",{d:"M483.589,222.024c-5.022-10.369-13.394-18.741-23.762-23.762L73.522,11.331C48.074-0.998,17.451,9.638,5.122,35.086\r C-1.159,48.052-1.687,63.065,3.669,76.44l67.174,167.902L3.669,412.261c-10.463,26.341,2.409,56.177,28.75,66.639\r c5.956,2.366,12.303,3.595,18.712,3.624c7.754,0,15.408-1.75,22.391-5.12l386.304-186.982\r C485.276,278.096,495.915,247.473,483.589,222.024z M58.657,446.633c-8.484,4.107-18.691,0.559-22.798-7.925\r c-2.093-4.322-2.267-9.326-0.481-13.784l65.399-163.516h340.668L58.657,446.633z M100.778,227.275L35.379,63.759\r c-2.722-6.518-1.032-14.045,4.215-18.773c5.079-4.949,12.748-6.11,19.063-2.884l382.788,185.173H100.778z"})})})]})})}function M(){return Object(k.jsxs)("div",{className:"Chat",children:[Object(k.jsx)(D,{}),Object(k.jsx)(R,{})]})}n(88);var T=function(){var e=Object(c.useState)(!1),t=Object(s.a)(e,2),n=t[0],r=t[1],o=function(e){m.user=e.data,p.localId=e.data.id,r(!0)};return Object(c.useEffect)((function(){if(g.addEventListener("logged",o),n)return window.addEventListener("beforeunload",g.onBeforeUnload),window.addEventListener("beforeunload",x.onBeforeUnload),function(){g.removeEventListener("logged",o),window.removeEventListener("beforeunload",x.onBeforeUnload),window.removeEventListener("beforeunload",g.onBeforeUnload)}}),[n]),Object(k.jsxs)("div",{className:"App",children:[" ",n?Object(k.jsx)(k.Fragment,{children:Object(k.jsx)(k.Fragment,{children:Object(k.jsxs)("div",{className:"App-body",children:[Object(k.jsx)("div",{className:"video-grid-container",children:Object(k.jsx)(N,{})}),Object(k.jsxs)("div",{className:"info-chat-container",children:[Object(k.jsx)(_,{}),Object(k.jsx)(M,{})]})]})})}):Object(k.jsx)(w,{})]})},U=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,90)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),c(e),r(e),o(e),i(e)}))};i.a.render(Object(k.jsx)(r.a.StrictMode,{children:Object(k.jsx)(T,{})}),document.getElementById("root")),U()}},[[89,1,2]]]);
//# sourceMappingURL=main.a5589d00.chunk.js.map